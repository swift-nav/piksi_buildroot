#!/bin/sh

# shellcheck disable=SC1091,SC2169,SC2039

name=feed_watchdog

source /etc/init.d/common.sh

export log_tag=$name # required by logging.sh
source /etc/init.d/logging.sh

if ! detect_piksi_ins; then
  # If we're not Piksi INS, keep our previous behavior and disable the watchdog...
  printf "V" > /dev/watchdog
else
  while true; do
    if ! pfw_welcome; then
      loge --sbp "Running pfw_welcome failed..."
      break
    fi
    printf '\000' >/dev/watchdog
  done
fi
